<div class="game-list-container">
  <div class="header-actions">
    <h2>ðŸ’¿ Game Inventory</h2>
    <button class="add-btn" routerLink="/add-game">+ Add Game</button>
  </div>

  <app-search-bar
    [placeholder]="'ðŸ” Search games by title...'"
    (searchQuery)="onSearch($event)"
  ></app-search-bar>

  <div class="filters">
    <div class="filter-group">
      <label>Genre:</label>
      <select
        title="genre-filter-select"
        (change)="onCategoryFilter($event, 'genre')"
        class="filter-select"
      >
        <option value="">All</option>
        <option *ngFor="let cat of genreCategories" [value]="cat.id">
          {{ cat.name }}
        </option>
      </select>
    </div>

    <div class="filter-group">
      <label>Franchise:</label>
      <select
        title="franchise-filter-select"
        (change)="onCategoryFilter($event, 'franchise')"
        class="filter-select"
      >
        <option value="">All</option>
        <option *ngFor="let cat of franchiseCategories" [value]="cat.id">
          {{ cat.name }}
        </option>
      </select>
    </div>

    <div class="filter-group">
      <label>Saga:</label>
      <select
        title="saga-filter-select"
        (change)="onCategoryFilter($event, 'saga')"
        class="filter-select"
      >
        <option value="">All</option>
        <option *ngFor="let cat of sagaCategories" [value]="cat.id">
          {{ cat.name }}
        </option>
      </select>
    </div>

    <div class="filter-group">
      <label>Custom:</label>
      <select
        title="custom-filter-select"
        (change)="onCategoryFilter($event, 'custom')"
        class="filter-select"
      >
        <option value="">All</option>
        <option *ngFor="let cat of customCategories" [value]="cat.id">
          {{ cat.name }}
        </option>
      </select>
    </div>

    <div class="filter-group">
      <label>Console:</label>
      <select
        title="console-filter-select"
        (change)="onConsoleFamilyFilter($event)"
        class="filter-select"
      >
        <option value="">All</option>
        <option *ngFor="let family of consoleFamilies" [value]="family.id">
          {{ family.name }}
        </option>
      </select>
    </div>

    <div class="filter-group date-range-group">
      <label>Release Date Range:</label>
      <input
        type="text"
        [(ngModel)]="dateRangeText"
        (focus)="showDatePicker = true"
        placeholder="Select date range..."
        class="date-range-input"
        readonly
      />
      <div
        class="date-picker-dropdown"
        *ngIf="showDatePicker"
        (clickOutside)="showDatePicker = false"
        (click)="$event.stopPropagation()"
      >
        <div class="date-picker-header">
          <input
            type="date"
            [(ngModel)]="dateFrom"
            (ngModelChange)="updateDateRangeText()"
            placeholder="From"
          />
          <span>to</span>
          <input
            type="date"
            [(ngModel)]="dateTo"
            (ngModelChange)="updateDateRangeText()"
            placeholder="To"
          />
        </div>
        <div class="date-picker-actions">
          <button class="apply-btn" (click)="applyDateRange()">Apply</button>
          <button class="clear-btn" (click)="clearDateRange()">Clear</button>
        </div>
      </div>
    </div>

    <button class="clear-filters-btn" (click)="clearFilters()">
      Clear Filters
    </button>
  </div>

  <div class="list-info">
    <span class="item-count">
      Showing **{{ games.length }}** games on page **{{ currentPage }}** of **{{
        totalPages
      }}** (Total: **{{ totalItems }}**)
    </span>
  </div>

  <div class="sort-controls">
    <label>Sort by:</label>
    <button
      (click)="toggleSort('title')"
      [class.active]="currentSort.field === 'title' "
    >
      Title
      {{
        currentSort.field === "title" && currentSort.direction === "asc"
          ? "â†‘"
          : currentSort.field === "title" && currentSort.direction === "desc"
          ? "â†“"
          : ""
      }}
    </button>
    <button
      (click)="toggleSort('date')"
      [class.active]="currentSort.field === 'date'"
    >
      Date
      {{
        currentSort.field === "date" && currentSort.direction === "asc"
          ? "â†‘"
          : currentSort.field === "date" && currentSort.direction === "desc"
          ? "â†“"
          : ""
      }}
    </button>
  </div>

  <div
    class="games-grid"
    *ngIf="games.length > 0"
    [@listAnimation]="games.length"
  >
    <div
      class="game-card"
      *ngFor="let game of games"
      (click)="viewGame(game.id)"
      [@cardAnimation]
    >
      <div class="game-cover">
        <img [src]="game.coverArt" [alt]="game.title" />
        <div
          class="physical-badge"
          [class.digital]="game.physicalDigital === 'digital'"
        >
          {{ game.physicalDigital === "physical" ? "ðŸ“€" : "ðŸ’¾" }}
        </div>
      </div>
      <div class="game-info">
        <h3 [title]="game.title" appOverflowClass="title-text-animated">
          <span class="title-text">{{ game.title }}</span>
        </h3>
        <p class="platform">{{ getConsoleFamilyName(game.consoleFamilyId) }}</p>
        <p class="release-date">{{ game.releaseDate | date }}</p>
      </div>
    </div>
  </div>

  <div class="no-games" *ngIf="games.length === 0">
    <p>No games found. Add your first game!</p>
  </div>

  <hr />

  <div class="pagination-controls" >
    <div class="limit-selector">
      <label for="limit">Items per page:</label>
      <select id="limit" [(ngModel)]="limit" (ngModelChange)="onLimitChange()">
        <option [ngValue]="10">10</option>
        <option [ngValue]="25">25</option>
        <option [ngValue]="50">50</option>
      </select>
    </div>

    <button
      class="page-btn"
      (click)="goToPage(currentPage - 1)"
      [disabled]="currentPage <= 1"
    >
      &lt; Previous
    </button>

    <span class="page-indicator">
      Page **{{ currentPage }}** of **{{ totalPages }}**
    </span>

    <button
      class="page-btn"
      (click)="goToPage(currentPage + 1)"
      [disabled]="currentPage >= totalPages"
    >
      Next &gt;
    </button>
  </div>
</div>
